<div [@pageAnimation]>
    <div class="page-header">
        <h1>Roles</h1>
        <button pButton label="Add Role" icon="pi pi-plus" class="btn-custom" (click)="openAddDialog()"></button>
    </div>

    <div class="custom-card">
        <p-table #dt [value]="RoleList()" [paginator]="true" [rows]="10"
            [globalFilterFields]="['RoleCode', 'RoleName', 'StatusName']"
            styleClass="p-datatable-sm">

            <ng-template pTemplate="caption">
                <div class="table-caption">
                    <div class="caption-search">
                        <i class="pi pi-search"></i>
                        <input type="text" (input)="dt.filterGlobal($any($event.target).value, 'contains')" placeholder="Search..." />
                    </div>
                    <div class="caption-actions">
                        <span class="caption-count">{{ dt.filteredValue?.length ?? RoleList().length }} records</span>
                        <button pButton icon="pi pi-file-pdf" class="caption-pdf-btn" pTooltip="Export to PDF" tooltipPosition="bottom" (click)="exportToPdf()"></button>
                        <button pButton icon="pi pi-file-excel" class="caption-export-btn" pTooltip="Export to Excel" tooltipPosition="bottom" (click)="exportToExcel()"></button>
                    </div>
                </div>
            </ng-template>

            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="RoleCode">Code <p-sortIcon field="RoleCode"></p-sortIcon></th>
                    <th pSortableColumn="RoleName">Role <p-sortIcon field="RoleName"></p-sortIcon></th>
                    <th pSortableColumn="StatusName">Status <p-sortIcon field="StatusName"></p-sortIcon></th>
                    <th style="width: 120px">Actions</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-role>
                <tr>
                    <td><span class="username">{{ role.RoleCode }}</span></td>
                    <td>{{ role.RoleName }}</td>
                    <td>
                        <p-tag [value]="role.StatusName" 
                               [severity]="role.StatusName =='Active' ? 'success' : 'danger'">
                        </p-tag>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button pButton icon="pi pi-eye" class="p-button-text p-button-sm"
                                (click)="view(role)" ></button>
                            <button pButton icon="pi pi-pencil" class="p-button-text p-button-sm"
                                (click)="edit(role)"></button>
                            <button pButton icon="pi pi-trash" class="p-button-text p-button-danger p-button-sm"
                                (click)="delete(role)"></button>
                        </div>
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="4" class="text-center">No roles found</td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>

@if(showDialog) {
<p-dialog [(visible)]="showDialog" [header]="dialogHeader" [modal]="true" [style]="{ width: '450px' }"
    [draggable]="false" [resizable]="false" styleClass="custom-dialog" [@dialogAnimation]>

    <app-c-role [roleData]="selectedRole" 
                (saveSuccess)="onSaveSuccess($event)"
                (closeDialog)="onCloseDialog()">
    </app-c-role>

    <ng-template pTemplate="footer">
        <button pButton label="Cancel" class="p-button-text" (click)="showDialog = false">
        </button>
        @if(selectedRole?.Action !== 'view') {
        <button pButton label="Save" class="btn-custom" (click)="saveRole()">
        </button>
        }
    </ng-template>
</p-dialog>
}